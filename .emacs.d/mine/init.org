* Header
#+begin_src emacs-lisp :lexical no :results silent
;;; -*- lexical-binding: t -*-
(setq gc-cons-threshold most-positive-fixnum)
#+end_src

* use-package
#+begin_src emacs-lisp :lexical no :results silent
(eval-and-compile
  (customize-set-variable
   'package-archives '(("org" . "https://orgmode.org/elpa/")
                       ("melpa" . "https://melpa.org/packages/")
                       ("gnu" . "https://elpa.gnu.org/packages/")))
  (package-initialize)
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
  (require 'use-package))

(use-package hydra
  :ensure t)

(use-package blackout
  :ensure t)
#+end_src

* faces:
** dashboard
#+begin_src emacs-lisp :lexical no :results silent
(use-package dashboard
  :ensure t
  :if (< (length command-line-args) 2)
  :mode ("\\*dashboard*\\'" . dashboard-mode)
  :hook (after-init . dashboard-setup-startup-hook)
  :custom
  ;; Value can be
  ;; 'official: which displays the official emacs logo
  ;; 'logo:     which displays an alternative emacs logo
  ;; 1, 2 or 3: which displays one of the text banners
  ;; "path/to/your/image.png" which displays whatever image you would prefer
  (dashboard-startup-banner 'logo)
  (dashboard-set-heading-icons t)
  (dashboard-set-file-icons t)
  (dashboard-center-content t)
  (dashboard-vertically-center-content t)
  (dashboard-items '((agenda . 10)
                       (projects . 5)
                       (recents . 5)))
  (initial-buffer-choice (lambda nil
                             (get-buffer "*dashboard*"))))
#+end_src

*** which-key
#+begin_src emacs-lisp :lexical no :results silent
(use-package which-key
    :ensure t
    :blackout t
    :hook (after-init . which-key-mode)
    :bind (:map which-key-mode-map
                ("C-x TAB" . which-key-C-h-dispatch))
    :custom
    ;; Set the time delay (in seconds) for the which-key popup to appear. A value of
    ;; zero might cause issues so a non-zero value is recommended.
    (which-key-idle-delay 0.3))
#+end_src

** line-number
#+begin_src emacs-lisp :lexical no :results silent
(use-package display-line-numbers
  :blackout t
  :hook (after-init . global-display-line-numbers-mode)
  :init
  (dolist (mode '(dired-mode-hook
                  dired-sidebar-mode-hook
                  magit-mode-hook
                  vterm-mode-hook))
    (add-hook mode
              (lambda nil
                (display-line-numbers-mode -1)))))
#+end_src

** tab-bar-mode
#+begin_src emacs-lisp :lexical no :results silent
(use-package tab-bar
  :hook (after-init . tab-bar-mode)
  :custom
  (tab-bar-new-tab-choice "*dashboard*"))
#+end_src
* config:
** Not to report warnings and errors from asynchronous native compilation.
#+begin_src emacs-lisp :lexical no :results silent
(use-package comp
  :init
  (defvar native-comp-async-report-warnings-errors)
  (setq native-comp-async-report-warnings-errors 'silent))
#+end_src

** clickable URL
#+begin_src elisp :lexical no :results silent
(global-goto-address-mode 1)
#+end_src

** éŸ³ã‚’é³´ã‚‰ã•ãªã„
#+begin_src emacs-lisp :lexical no :results silent
(setq ring-bell-function 'ignore)
#+end_src

**  "y" or "n" instead of "yes" or "no"
#+begin_src emacs-lisp :lexical no :results silent
(setq use-short-answers t)
#+end_src

** Do not delete files actually
#+begin_src emacs-lisp :lexical no :results silent
(setq delete-by-moving-to-trash t)
#+end_src

** historyé–¢é€£
#+begin_src emacs-lisp :lexical no :results silent
(setq history-delete-duplicates t)
(setq history-length 1000)
#+end_src

** ã‚¹ãƒ ãƒ¼ã‚ºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹
#+begin_src emacs-lisp :lexical no :results silent
(setq scroll-conservatively 1)
(setq mouse-wheel-scroll-amount '(1 ((control) 5)))
(setq scroll-preserve-screen-position t)
  #+end_src

#+begin_src emacs-lisp :lexical no :results silent
(use-package emacs
  :init
  (defvar select-enable-clipboard)
  (defvar auto-save-draft)
  (defvar show-trailing-whitespace)
  (setq select-enable-clipboard t)
  (setq indent-tabs-mode nil)
  (setq scroll-bar-mode nil)
  (setq truncate-lines t)
  (setq create-lockfiles nil)
  (setq auto-save-draft nil)
  (setq show-trailing-whitespace t)
  (setq process-adaptive-read-buffering t))

(use-package files
  :hook (before-save-hook . delete-trailing-whitespace)
  :custom
  (make-backup-files nil)
  (backup-inhibited nil))

(when (and (memq window-system '(ns nil))
           (fboundp 'mac-get-current-input-source))
  (when (version< "27.0" emacs-version)
    ;; Required for some cases when auto detection is failed or the locale is "en".
    (custom-set-variables
     '(mac-default-input-source "com.google.inputmethod.Japanese.base")))
  ;; supress `'Warning: the function â€˜mac-input-method-modeâ€™ is not known to be defined.`'
  (declare-function mac-input-method-mode "mac-input-method-mode")
  (mac-input-method-mode 1))

(use-package cus-edit
  :custom `((custom-file . ,(locate-user-emacs-file "custom.el"))))

(use-package autorevert
  :custom (auto-revert-interval 0.1)
  :hook (after-init . global-auto-revert-mode))

(use-package delsel
  :hook (after-init . delete-selection-mode))

(use-package paren
  :hook (after-init . show-paren-mode))

(use-package elec-pair
  :hook (after-init . electric-pair-mode)
  :custom
  (electric-pair-delete-adjacent-pairs t))

(use-package simple
  :custom
  ;; do not show line numbers in the mode line
  (line-number-mode nil)
  ;; do not show column numbers in the mode line
  (column-number-mode nil))

(use-package eldoc
  :blackout t)
 #+end_src
** dired
#+begin_src emacs-lisp :lexical no :results silent
(use-package dired
  :preface
  (declare-function dired-hide-details-mode "dired")
  (defun struuuuggle/setup-dired nil
    "Hide permissions"
    (dired-hide-details-mode 1))
  :hook (dired-mode . struuuuggle/setup-dired)
  :custom
  ;; human-readable file sizes
  ;; (dired-listing-switches . "-lha")
  ;; Automatically revert Dired buffers on revisiting their directory.
  (dired-auto-revert-buffer t)
  ;; Make dired always use the same buffer
  (dired-kill-when-opening-new-dired-buffer t))
#+end_src
** dired-sidebar
#+begin_src emacs-lisp :lexical no :results silent
(use-package dired-sidebar
  :ensure t
  :commands dired-sidebar-toggle-sidebar
  :bind
  ("s-1" . dired-sidebar-toggle-sidebar)
  :custom
  (dired-sidebar-use-custom-modeline nil)
  (dired-sidebar-use-custom-font t))
#+end_src

* theme
#+begin_src emacs-lisp :lexical no :results silent
(use-package doom-themes
  :ensure t
  :config
  (load-theme 'doom-dracula t)
  (doom-themes-org-config)
  (custom-set-faces
   `(default				((t :background ,(doom-color 'base1))))
   `(dired-directory			((t :foreground ,(doom-color 'cyan))))
   `(line-number			((t :height 0.7 :foreground ,(doom-color 'grey))))
   `(line-number-current-line 	((t :height 0.7 :foreground ,(doom-color 'green))))
   `(mode-line			((t :background ,(doom-blend (doom-color 'green) (doom-color 'bg) 0.3) :foreground ,(doom-color 'fg))))
   ;; `(mode-line-inactive		((t :background ,(doom-color 'base))))
   `(font-lock-comment-face		((t :foreground ,(doom-color 'doc-comments))))
   `(org-block-begin-line		((t :background ,(doom-color 'base2) :foreground ,(doom-color 'doc-comments))))
   `(org-block			((t :background ,(doom-color 'base2) :foreground ,(doom-color 'fg-alt))))
   `(org-block-end-line		((t :background ,(doom-color 'base2))))
   `(ivy-posframe			((t :background ,(doom-color 'base2))))
   `(ivy-posframe-border		((t :background ,(doom-color 'green))))
   `(tab-bar-tab			((t :background ,(doom-color 'base6) :foreground ,(doom-color 'bg-alt) :weight bold))) ;; active tab
   `(tab-bar-tab-inactive		((t :background ,(doom-color 'base1)))))
  (set-face-foreground 'vertical-border (doom-color 'base5))
  (set-cursor-color (doom-color 'green))
  :custom
  (doom-themes-padded-modeline t)
  (doom-modeline-project-name t))
#+end_src

** mode-line
#+begin_src emacs-lisp :lexical no :results silent
(use-package doom-modeline
  :ensure t
  :hook (after-init . doom-modeline-mode)
  :init
  (defvar doom-modeline-icon)
  :config
  (setq doom-modeline-icon t)
  :custom
  (doom-modeline-project-detection nil)
  (doom-modeline-workspace-name nil)
  (doom-modeline-percent-position nil)
  (doom-modeline-vcs-max-length 45) ;; default: 15
  (doom-modeline-buffer-file-name-style 'truncate-nil)
  (doom-modeline-buffer-encoding nil))
#+end_src

** CUI
Use a box-drawing glyph for vertical splits in terminal Emacs.
#+begin_src emacs-lisp :lexical no :results silent
(when (not (display-graphic-p))
  (setq standard-display-table (or standard-display-table (make-display-table)))
  (set-display-table-slot standard-display-table 'vertical-border ?\u2502))
#+end_src

** toggle opacity
#+begin_src emacs-lisp :lexical no :results silent
(defun struuuuggle/toggle-opacity ()
  "Toggle the opacity of the entire window."
  (interactive)
  (set-frame-parameter nil 'alpha (if (< (if (frame-parameter nil 'alpha) (frame-parameter nil 'alpha) 0) 100) 100 85)))
(global-set-key (kbd "s-u") 'struuuuggle/toggle-opacity)
#+end_src

** ã‚«ãƒ¼ã‚½ãƒ«è¡Œãƒã‚¤ãƒ©ã‚¤ãƒˆ
#+begin_src emacs-lisp :lexical no :results silent
(use-package hl-line
  :hook (after-init . global-hl-line-mode)
  :config
  (set-face-attribute 'hl-line nil
                      :background (doom-blend (doom-color 'green) (doom-color 'bg) 0.15)))
#+end_src

* window
#+begin_src emacs-lisp :lexical no :results silent
(use-package ace-window
  :ensure t
  :after ivy-posframe
  :custom
  (aw-keys '(?j ?k ?h ?l ?a ?s ?d ?f ?g))
  (aw-ignore-current t)
  (aw-minibuffer-flag nil)
  :bind ("C-o" . ace-window)
  :config
  (set-face-attribute 'aw-leading-char-face nil :height 4.0 :foreground "#999999")
  (ace-window-posframe-mode 1))
#+end_src

* indent:
** ã‚¿ãƒ–å¹…ã‚’ã‚¹ãƒšãƒ¼ã‚¹2ã¤åˆ†ã«ã™ã‚‹
#+begin_src emacs-lisp :lexical no :results silent
(setq-default tab-width 2)
#+end_src
** ã‚¿ãƒ–æ–‡å­—ã§ã¯ãªãã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ã†
#+begin_src emacs-lisp :lexical no :results silent
(setq-default tab-width 2)
(setq-default indent-tabs-mode nil)
#+end_src

** GUIã®ã¿indent-guidesã‚’æœ‰åŠ¹åŒ–
#+begin_src emacs-lisp :lexical no :results silent
(use-package highlight-indent-guides
  :ensure t
  :if (window-system)
  :blackout t
  :hook ((prog-mode . highlight-indent-guides-mode)
         (yaml-mode . highlight-indent-guides-mode))
  :custom
  (highlight-indent-guides-auto-enabled t)
  (highlight-indent-guides-responsive t)
  ;; column
  (highlight-indent-guides-method 'character))
#+end_src

* flycheck:
#+begin_src emacs-lisp :lexical no :results silent
(use-package flycheck
  :if (version<= "24.3" emacs-version)
  :blackout t
  :ensure t
  :bind (("M-n" . flycheck-next-error)
         ("M-p" . flycheck-previous-error))
  :custom (flycheck-elisp-initialize-packages t)
  :hook ((elisp-mode . flycheck-mode)
         (lisp-interaction-mode . flycheck-mode))
  :config
  (use-package flycheck-package
    :ensure t
    :config
    (flycheck-package-setup))

  (use-package flycheck-elsa
    :if (version<= "25" emacs-version)
    :ensure t
    :config
    (flycheck-elsa-setup)))


#+end_src

* ivy:
#+begin_src emacs-lisp :lexical no :results silent
(use-package ivy
  :if (version<= "24.5" emacs-version)
  :ensure t
  :blackout t
  :demand t
  :custom ((ivy-initial-inputs-alist nil)
           (ivy-use-selectable-prompt t)
           (ivy-display-style t)
           (ivy-height-alist '((t lambda (_caller) (/ (frame-height) 2))))
           ;; è¡ŒãŒé•·ã„ã¨ãã¯æŠ˜ã‚Šè¿”ã™
           (ivy-truncate-lines nil)
           ;; æœ€åˆã¨æœ€å¾Œã®å€™è£œã‚’è¡Œãæ¥ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
           (ivy-wrap t))
  :config
  (ivy-mode 1)
  (use-package swiper
    :if (version<= "24.5" emacs-version)
    :ensure t
    :commands swiper-isearch-thing-at-point
    :bind (("C-s" . swiper)
           ("M-s" . 'swiper-isearch-thing-at-point)))

  (use-package counsel
    :if (version<= "24.5" emacs-version)
    :ensure t
    :blackout t
    :bind (("C-S-s" . counsel-imenu)
           ("C-x C-r" . counsel-recentf))
    :custom `((counsel-yank-pop-separator . "\n----------\n")
              (counsel-find-file-ignore-regexp . ,(rx-to-string '(or "./" "../") 'no-group)))
    :config
    (counsel-mode 1))

(use-package ivy-prescient
  :if (version<= "25.1" emacs-version)
  :ensure t
  :after prescient ivy
  :custom (ivy-prescient-retain-classic-highlighting t)
  :config
  (ivy-prescient-mode 1))

  (use-package ivy-rich
    :ensure t
    :config
    (ivy-rich-mode 1)))

#+end_src
** ivy-postframe
#+begin_src emacs-lisp :lexical no :results silent
(use-package ivy-posframe
  :if window-system
  :ensure t
  :init
  (defvar ivy-posframe-display-functions-alist)
  (defvar ivy-posframe-parameters)
  ;; (ivy-posframe-display-functions-alist quote ((t . ivy-posframe-display)))
  (setq ivy-posframe-parameters '((internal-border-width . 10)))
  :config
  (setq ivy-posframe-parameters
      '((left-fringe . 8)
        (right-fringe . 8)))
  (setq ivy-posframe-display-functions-alist
      '((swiper							. ivy-display-function-fallback)
        (counsel-M-x				. ivy-posframe-display-at-frame-center)
        (counsel-recentf		. ivy-posframe-display-at-frame-center)
        (t									. ivy-posframe-display)))
  (ivy-posframe-mode 1))
#+end_src
** prescient
#+begin_src emacs-lisp :lexical no :results silent
(use-package prescient
  :if (version<= "25.1" emacs-version)
  :ensure t
  :commands prescient-persist-mode
  :custom (prescient-aggressive-file-save t)
  :config
  (prescient-persist-mode 1))
#+end_src

* company:
#+begin_src emacs-lisp :lexical no :results silent
(use-package company
  :if (version<= "24.3" emacs-version)
  :ensure t
  :blackout t
  :demand t
  :bind (("M-SPC" . company-complete)
         :map company-active-map
         ("M-n" . nil)
         ("M-p" . nil)
         ("C-s" . company-filter-candidates)
         ("C-n" . company-select-next)
         ("C-p" . company-select-previous)
         ("<tab>" . company-complete-selection)
         :map company-search-map
         ("C-n" . company-select-next)
         ("C-p" . company-select-previous))
  :custom ((company-idle-delay 0)
           (company-minimum-prefix-length 1)
           (company-transformers '(company-sort-by-occurrence))
           ;; å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ã¦è£œå®Œã™ã‚‹
           (company-dabbrev-downcase nil))
  :config
  (global-company-mode 1))
#+end_src

* git:
** magit
#+begin_src emacs-lisp :lexical no :results silent
(use-package magit
  :ensure t
  :bind
  ("C-x g" . magit-status)
  :init
  (defvar magit-display-buffer-function)
  :preface
  (declare-function magit-display-buffer-fullframe-status-v1 "magit")
  :config
  ;; disable "--force" option
  (transient-remove-suffix 'magit-push "-F")
  ;; see also: https://magit.vc/manual/magit/Performance.html#Refs-Buffer-Performance-1
  (remove-hook 'magit-status-sections-hook 'magit-insert-tags-header)
  (defun magit-pr-review (&optional range)
    "Review a Pull Request by diffing against the default branch.
If RANGE is not provided, defaults to `origin/main...HEAD`."
    (interactive
     (let* ((default "origin/main...HEAD")
            (input (read-string (format "Diff range (%s): " default))))
       (list (if (string-empty-p input) default input))))
    (magit-diff-range range))
  :custom
  (magit-revision-insert-related-refs nil)
  (magit-display-buffer-function #'magit-display-buffer-fullframe-status-v1))
#+end_src

** git-gutter
#+begin_src emacs-lisp :lexical no :results silent
(use-package git-gutter
  :ensure t
  :custom
  (git-gutter:modified-sign " ")
  (git-gutter:added-sign    " ")
  (git-gutter:deleted-sign  " ")
  :config
  (set-face-attribute 'git-gutter:modified nil :background (doom-color 'yellow))
  (set-face-attribute 'git-gutter:added nil :background (doom-color 'green))
  (set-face-attribute 'git-gutter:deleted nil :background (doom-color 'magenta))
  (global-git-gutter-mode 1))

;; ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®èª­ã¿è¾¼ã¿ã‚’è¨±å¯
(setq vc-follow-symlinks t)

;; ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯å…ˆã®VCSå†…ã§æ›´æ–°ãŒå…¥ã£ãŸå ´åˆã«ãƒãƒƒãƒ•ã‚¡ã‚’è‡ªå‹•æ›´æ–°
;; (setq auto-revert-check-vc-info t)
#+end_src

** ediff
#+begin_src emacs-lisp :lexical no :results silent
(use-package ediff
  :custom
  ;; Split WINDOW-TO-SPLIT into two side-by-side windows.
  (ediff-split-window-function 'split-window-horizontally))
#+end_src
* font:
#+begin_src emacs-lisp :lexical no :results silent
;; è¡¨ç¤ºç¢ºèªç”¨:
;; 0123456789012345678901234567890123456789
;; ä¸€äºŒä¸‰å››äº”å…­ä¸€äºŒä¸‰å››äº”å…­ä¸€äºŒä¸‰å››äº”å…­ä¸€äºŒä¸‰å››äº”å…­

(set-face-attribute 'default nil :family "Fira Code" :weight 'light :height 140)

(use-package fira-code-mode
  :if window-system
  :blackout t
  :ensure t
  :config
  (global-fira-code-mode)
  (fira-code-mode-set-font)
  :custom
  (fira-code-mode-disabled-ligatures '("[]" "x"))
  (fira-code-mode-enable-hex-literal nil)
  (fira-code-mode-disabled-ligatures nil))
#+end_src

** icons
#+begin_src emacs-lisp :lexical no :results silent
(use-package all-the-icons
  :if (display-graphic-p)
  :demand t
  :ensure t
  :config
  (use-package all-the-icons-ivy-rich
    :ensure t
    :init
    (all-the-icons-ivy-rich-mode 1)
    :demand t)
  (use-package all-the-icons-dired
    :ensure t
    :hook (dired-mode . all-the-icons-dired-mode)))
#+end_src

* lsp
#+begin_src emacs-lisp :lexical no :results silent
;; (use-package eglot
;;   :ensure t
;;   :commands eglot-ensure
;;   :hook ((swift-mode-hook . eglot-ensure))
;;   :config
;;   (with-eval-after-load 'eglot
;;     (message "warning: `jsonrpc--log-event' is ignored.")
;;     (fset #'jsonrpc--log-event #'ignore)
;;     (add-to-list 'eglot-server-programs
;;                  '(swift-mode "/Applications/Xcode-15.2.0.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/sourcekit-lsp"))))

(use-package lsp-mode
  :demand t
  :ensure t
  :hook
  (swift-mode . lsp)
  (ruby-mode . lsp)
  (elisp-mode . lsp)
  (sh-mode . lsp)
  :init
  (defvar lsp-disabled-clients)
  (setq lsp-disabled-clients '(rubocop-ls ruby-ls))
  :config
  (use-package lsp-ui
    :demand t
    :ensure t
    :preface
    (declare-function lsp-ui-doc--hide-frame "lsp-ui-doc")
    (declare-function lsp-ui-doc-show "lsp-ui-doc")
    (declare-function lsp-ui-doc-mode "lsp-ui-doc")
    (defvar lsp-ui-doc-mode)
    (defun struuuuggle/toggle-lsp-ui-doc ()
      (interactive)
      (if lsp-ui-doc-mode
          (progn
            (lsp-ui-doc-mode -1)
            (lsp-ui-doc--hide-frame))
        (progn
          (lsp-ui-doc-mode 1)
          (lsp-ui-doc-show))))
    :bind
    (("M-s-0" . imenu-list-smart-toggle)
     :map lsp-mode-map
     ("C-j" . struuuuggle/toggle-lsp-ui-doc)
     ("M-RET" . lsp-execute-code-action))
    :custom
    ;; lsp-ui-doc
    (lsp-ui-doc-enable t)
    (lsp-ui-doc-position 'at-point) ;; top, bottom, or at-point
    (lsp-ui-doc-max-width 200) ;; Original value is 150
    (lsp-ui-doc-max-height 30) ;; Original value is 13
    (lsp-ui-doc-use-childframe t)
    (lsp-ui-doc-use-webkit t)
    ;; lsp-ui-flycheck
    (lsp-ui-flycheck-enable nil)
    ;; lsp-ui-imenu
    (lsp-ui-imenu-enable nil)
    (lsp-ui-imenu-kind-position 'top)
    ;; lsp-ui-peek
    (lsp-ui-peek-enable t)
    (lsp-ui-peek-peek-height 30)
    (lsp-ui-peek-list-width 8)
    ;; never, on-demand, or always
    (lsp-ui-peek-fontify 'always))

  (use-package smart-jump
    :ensure t
    :bind
    ("s-b" . smart-jump-go)
    ("M-," . smart-jump-back)))
#+end_src

** emacs-lsp-booster
https://github.com/blahgeek/emacs-lsp-booster?tab=readme-ov-file#configure-lsp-mode
#+begin_src emacs-lisp :lexical no :results silent
(defun lsp-booster--advice-json-parse (old-fn &rest args)
  "Try to parse bytecode instead of json."
  (or
   (when (equal (following-char) ?#)
     (let ((bytecode (read (current-buffer))))
       (when (byte-code-function-p bytecode)
         (funcall bytecode))))
   (apply old-fn args)))
(advice-add (if (progn (require 'json)
                       (fboundp 'json-parse-buffer))
                'json-parse-buffer
              'json-read)
            :around
            #'lsp-booster--advice-json-parse)

(defun lsp-booster--advice-final-command (old-fn cmd &optional test?)
  "Prepend emacs-lsp-booster command to lsp CMD."
  (let ((orig-result (funcall old-fn cmd test?)))
    (if (and (not test?)                             ;; for check lsp-server-present?
             (not (file-remote-p default-directory)) ;; see lsp-resolve-final-command, it would add extra shell wrapper
             lsp-use-plists
             (not (functionp 'json-rpc-connection))  ;; native json-rpc
             (executable-find "emacs-lsp-booster"))
        (progn
          (when-let ((command-from-exec-path (executable-find (car orig-result))))  ;; resolve command from exec-path (in case not found in $PATH)
            (setcar orig-result command-from-exec-path))
          (message "Using emacs-lsp-booster for %s!" orig-result)
          (cons "emacs-lsp-booster" orig-result))
      orig-result)))
(advice-add 'lsp-resolve-final-command :around #'lsp-booster--advice-final-command)
#+end_src

* languages:
** Swift
#+begin_src emacs-lisp :lexical no :results silent
(use-package swift-mode
  :demand t
  :ensure t
  :hook (swift-mode . flycheck-swift3-setup)
  :config
  (use-package flycheck-swift3
    :ensure t)
  (use-package lsp-sourcekit
    :demand t
    :ensure t
    :if
    (= 0 (call-process "which" nil nil nil "xcrun"))
    :after eglot
    :init
    (defvar xcode-path)
    (setq xcode-path (string-trim (shell-command-to-string "xcode-select --print-path")))
    :custom
    ;; configure the package to point to the sourcekit-lsp executable
    `(lsp-sourcekit-executable . ,(string-trim (shell-command-to-string "xcrun --find sourcekit-lsp")))
    (lsp-sourcekit-extra-args `("-Xswiftc"
                                  "-sdk"
                                  "-Xswiftc"
                                  ,(concat xcode-path "/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneOS.sdk")
                                  "-Xswiftc"
                                  "-target"
                                  "-Xswiftc"
                                  "arm64-apple-ios18.2-simulator"))))
#+end_src

** json
#+begin_src emacs-lisp :lexical no :results silent
(use-package json-mode
  :ensure t
  :config
  (use-package json-reformat
    :if (version<= "23" emacs-version)
    :ensure t
    :custom
    (json-reformat:indent-width 2)))
#+end_src

** YML
#+begin_src emacs-lisp :lexical no :results silent
(use-package yaml-mode
  :ensure t)
#+end_src

** Ruby
#+begin_src emacs-lisp :lexical no :results silent
(use-package ruby-mode
  :mode "Fastfile$" "Gymfile$" "Dangerfile")
#+end_src

** Kotlin
#+begin_src emacs-lisp :lexical no :results silent
(use-package kotlin-mode
  :ensure t)
#+end_src

** Dockerfile
#+begin_src emacs-lisp :lexical no :results silent
(use-package dockerfile-mode
  :ensure t)
#+end_src
** sh
#+begin_src emacs-lisp :lexical no :results silent
(use-package flymake-shellcheck
  :ensure t
  :commands flymake-shellcheck-load
  :hook ((sh-mode . flymake-shellcheck-load)))
#+end_src


* org-mode:
#+begin_src emacs-lisp :lexical no :results silent
(use-package org
  :init
  (defvar org-inline-image-overlays)
  :preface
  (declare-function org-redisplay-inline-images "org")
  (declare-function org-todo "org")
  (declare-function org-get-todo-state "org")
  (defun show-org-buffer (file)
    "Show an org-file FILE on the current buffer."
    (interactive)
    (if (get-buffer file)
        (let ((buffer (get-buffer file)))
          (switch-to-buffer buffer)
          (message "%s" file))
      (find-file (concat "~/Documents/Org/" file))))
  :hook
  ;; org-inline-image-overlays
  ;; https://github.com/xenodium/ob-swiftui#auto-refresh-results-file-image
  (org-babel-after-execute-hook . (lambda ()
                                    (when org-inline-image-overlays
                                      (org-redisplay-inline-images))))
  (org-clock-in-hook . (lambda nil
                         "Clock in ã—ãŸã¨ãã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’DOINGã«å¤‰æ›´"
                         (when (equal
                                (org-get-todo-state)
                                "TODO")
                           (org-todo "DOING"))))
  (org-clock-out-hook . (lambda nil
                          "Clock out ã—ãŸã¨ãã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’DONEã«å¤‰æ›´"
                          (when (equal
                                 (org-get-todo-state)
                                 "DOING")
                            (org-todo "DONE"))))
  :custom
  ;; ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’æœ‰åŠ¹åŒ–
  (org-use-speed-commands t)
  ;; dã§ã‚¿ã‚¹ã‚¯ã‚’DONEã«ã™ã‚‹
  (org-speed-commands-user '(("d" org-todo "DONE")))
  ;; org-babelã«ä½¿ç”¨ã§ãã‚‹è¨€èªã‚’è¿½åŠ ã™ã‚‹
  (org-babel-load-languages '((shell . t)
                                (swift . t)
                                (kotlin . t)
                                (haskell . t)
                                (python . t)
                                (ruby . t)))
  ;; ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å®Ÿè¡Œå‰ã«ç¢ºèªã‚’æ±‚ã‚ãªã„
  (org-confirm-babel-evaluate nil)
  ;; è¡Œã‚’æŠ˜ã‚Šè¿”ã™
  (org-startup-truncated nil)
  ;; ç”»åƒã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§è¡¨ç¤º
  (org-startup-with-inline-images t)
  ;; è¦‹å‡ºã—ã®ä½™åˆ†ãª*ã‚’æ¶ˆã™
  (org-hide-leading-stars t)
  (org-todo-keywords '((sequence "TODO" "DOING" "SOMEDAY" "|" "DONE(!)" "CLOSED")))
  ;; ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
  (org-directory "~/Documents/Org/")
  :bind
  ;; org-mode
  ;; (global-set-key (kbd "C-c p") 'org-preview-html-mode)
  ;; memo.orgã‚’é–‹ã
  ("C-c m" . (lambda ()
               (interactive)
               (show-org-buffer "memo.org"))))
#+end_src

** org-capture
#+begin_src emacs-lisp :lexical no :results silent
(use-package org-capture
  :custom
  ;; Org-captureã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  ;;
  ;; Template expansion
  ;; https://orgmode.org/manual/Template-expansion.html#Template-expansion
  ;;
  ;; %t: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(æ—¥ä»˜ã®ã¿)
  ;; %T: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(æ—¥ä»˜ã¨æ™‚åˆ»)
  ;; %u: éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(æ—¥ä»˜ã®ã¿) éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯agendaã«å½±éŸ¿ã—ãªã„
  ;; %U: éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(æ—¥ä»˜ã¨æ™‚åˆ»)
  ;; %?: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è£œå®Œã—ãŸå¾Œã®ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®
  ;; %i: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ã§captureãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«ã€æŒ¿å…¥ã•ã‚Œã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
  (org-capture-templates '(
                             ("m"
                              "ğŸ’¡ Memo"
                              entry
                              (file+olp+datetree "~/Documents/Org/memo.org")
                              "* %?\n  %i\n  ")
                             (
                              "t"
                              "âœ…ï¸ To Do" entry
                              (file+headline "~/Documents/Org/task.org" "Task")
                              "* TODO %?\nat %U")))
  :bind
  ("C-c c" . 'org-capture))
#+end_src

** rich UI
#+begin_src emacs-lisp :lexical no :results silent
(use-package org-superstar
  :ensure t
  :custom
  (org-superstar-headline-bullets-list '("#" "â—‹" "â—" "â—‹" "â—" "â—‹"))
  (org-superstar-special-todo-items t)
  :hook (org-mode . org-superstar-mode)
  :config
  (set-face-attribute 'org-level-3 nil :inherit 'org-level-8 :height 1.2)
  (set-face-attribute 'org-level-2 nil :inherit 'org-level-8 :height 1.4)
  (set-face-attribute 'org-level-1 nil :inherit 'org-level-8 :height 1.4))
  #+end_src

#+begin_src emacs-lisp :lexical no :results silent
(use-package org-indent
  :custom
  (org-startup-indented t)
  (org-startup-folded 'showall))

(use-package company-org-block
  :ensure t
  :hook
  (org-mode . (lambda ()
                (setq-local company-backends '(company-org-block))
                (company-mode 1))))
#+end_src

** org-agenda
#+begin_src emacs-lisp :lexical no :results silent
(use-package org-agenda
  :if (eq system-type 'gnu/linux)
  :custom
  (org-agenda-files '("~/Documents/Org/"))
  (calendar-holidays nil)
  (org-agenda-format-date "%+4Y/%0m/%0d (%a)")
  :bind
  ("C-c a" . 'org-agenda))

(use-package org-super-agenda
  :ensure t
  :hook (org-mode . org-super-agenda-mode)
  :custom
  ;; https://github.com/alphapapa/org-super-agenda/blob/master/examples.org#zaen323
  (org-agenda-time-grid '((daily today require-timed)
                            "----------------------" nil))
  (org-agenda-skip-scheduled-if-done t)
  (org-agenda-skip-deadline-if-done t)
  (org-agenda-include-deadlines t)
  (org-agenda-include-diary t)
  (org-agenda-block-separator nil)
  (org-agenda-compact-blocks t)
  (org-agenda-start-with-log-mode t)
  (org-agenda-custom-commands
   '(("z" "ğŸ“Œ struuuuggle view"
      ((agenda "" ((org-agenda-span 'day)
                   (org-super-agenda-groups
                    '((:name "Today"
                             :time-grid t
                             :date today
                             :todo "TODAY"
                             :scheduled today
                             :order 1)))))
       (alltodo "" ((org-agenda-overriding-header "")
                    (org-super-agenda-groups
                     '((:name "Next to do"
                              :todo "NEXT"
                              :order 1)
                       (:name "Important"
                              :priority "A"
                              :order 6)
                       (:name "Due Today"
                              :deadline today
                              :order 2)
                       (:name "Due Soon"
                              :deadline future
                              :order 8)
                       (:name "Overdue"
                              :deadline past
                              :order 7)
                       (:name "Waiting"
                              :todo "WAITING"
                              :order 20))))))))))
#+end_src
** org-journal
#+begin_src emacs-lisp :lexical no :results silent
(use-package org-journal
  :ensure t
  :custom
  (org-journal-dir "~/Documents/Org/journal")
  (org-journal-date-format "%Y-%m-%d.org")
  (org-journal-file-header "#+OPTIONS: ^:nil\n")
  (org-journal-time-prefix "** TODO ")
  :bind
  ("C-c j" . 'org-journal-new-entry))
#+end_src

** org-babel
#+begin_src emacs-lisp :lexical no :results silent
(use-package ob-swift
  :after ob
  :ensure t)

(use-package ob-swiftui
  :ensure t
  :demand t
  :init
  (defvar org-edit-src-content-indentation)
  (defvar org-babel-tangle-lang-exts)
  (defvar org-babel-load-languages)
  (defvar org-src-lang-modes)
  :after ob-tangle
  :config
  (setq org-edit-src-content-indentation 0)
  (add-to-list 'org-babel-tangle-lang-exts
               '("swiftui" . "swift"))
  (add-to-list 'org-babel-load-languages
               '((swiftui . t)))
  (add-to-list 'org-src-lang-modes
               '("swiftui" . swift)))

(use-package ob-kotlin
  :ensure t)
#+end_src

** org-pomodoro
#+begin_src emacs-lisp :lexical no :results silent
(use-package org-pomodoro
  :ensure t)
#+end_src
** org-modeã®ãƒ†ãƒ¼ãƒ–ãƒ«ç¸¦ç·šã‚’æƒãˆã‚‹
#+begin_src emacs-lisp :lexical no :results silent
(use-package valign
  :ensure t
  :hook (org-mode . valign-mode))
#+end_src
* projectile
#+begin_src emacs-lisp :lexical no :results silent
(use-package projectile
  :ensure t
  :blackout t
  :preface
  (declare-function projectile-project-name "projectile")
  :custom
  (projectile-switch-project-action
   (lambda ()
     (let ((tab-bar-new-tab-choice nil)) ;; ä¸€æ™‚çš„ã« dashboard èµ·å‹•ã‚’æŠ‘åˆ¶
       (tab-new))
     (tab-bar-rename-tab (projectile-project-name))
     (magit-status)))
  (projectile-verbose nil)
  (projectile-completion-system 'ivy)
  :init
  (projectile-mode 1)
  :config
  (defvar projectile-project-search-path)
  (if noninteractive
      (setq projectile-project-search-path nil)
    (setq projectile-project-search-path '("~/sandbox/" ("~/ghq/" . 3))))
  (use-package ag
    :if (executable-find "ag")
    :ensure t
    :custom
    (ag-reuse-buffers t)
    (ag-highlight-search t))
  (use-package projectile-rails
    :ensure t)
  :bind (:map projectile-mode-map
              ("s-p" . projectile-command-map)
              ("s-O" . projectile-find-file)))
#+end_src

* shell
** PATH
We don't have to use [[https://github.com/purcell/exec-path-from-shell][exec-path-from-shell]] anymore.
See also [[https://github.com/d12frosted/homebrew-emacs-plus?tab=readme-ov-file#injected-path][homebrew-emacs-plus#README]].

** vterm
#+begin_src emacs-lisp :lexical no :results silent
(use-package vterm
  :ensure t
  :preface
  (declare-function vterm-send-key "vterm")
  (defun send-backspace nil
    "Send a backspace character to vterm process."
    (interactive)
    (vterm-send-key (kbd "C-h")))
  :custom
  (vterm-shell "/bin/zsh")
  (vterm-kill-buffer-on-exit t)
  (vterm-buffer-name-string "vterm: %s")
  (vterm-keymap-exceptions '("C-'" "C-x" "C-c" "C-o" "M-x"))
  ;; Emacsçµ‚äº†æ™‚ã«vtermãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèªã‚’æ±‚ã‚ãªã„
  (confirm-kill-processes nil)
  :config
  (use-package vterm-toggle
    :ensure t
    :custom
    (vterm-toggle-scope 'project))
  (add-hook 'vterm-mode-hook
            (lambda nil
              (local-set-key (kbd "C-h") #'send-backspace)))
  ;; (add-to-list 'vterm-eval-cmds '("update-pwd" (lambda (path) (setq default-directory path))))
  )
#+end_src

* yasnippet
#+begin_src emacs-lisp :lexical no :results silent
(use-package yasnippet
  :ensure t
  :hook ((prog-mode . yas-minor-mode)
         (org-mode . yas-minor-mode)))
#+end_src

* tramp
#+begin_src emacs-lisp :lexical no :results silent
(use-package tramp
  :ensure t)
#+end_src

* keybind
#+begin_src emacs-lisp :lexical no :results silent
(global-set-key "\C-h" 'delete-backward-char)
;; alias of "M-g M-g"
(global-set-key "\M-g" 'goto-line)
(global-set-key (kbd "s-/") 'comment-line)
(global-set-key "\M-;" 'comment-line)
(global-set-key "\C-c\C-x" 'eval-buffer)
(global-set-key (kbd "C-x C-b") 'ibuffer)
(global-set-key (kbd "s-{") (lambda () (interactive) (other-window -1)))
(global-set-key (kbd "s-}") (lambda () (interactive) (other-window 1)))
(global-set-key (kbd "s-t") 'vterm-toggle)
(global-set-key (kbd "s-w") 'kill-current-buffer)
(global-set-key (kbd "s-z") 'undo)
(global-set-key (kbd "s-Z") 'undo-redo)
(global-set-key (kbd "s-[") 'tab-bar-switch-to-prev-tab)
(global-set-key (kbd "s-]") 'tab-bar-switch-to-next-tab)
(global-set-key (kbd "s-{") 'tab-bar-switch-to-prev-tab)
(global-set-key (kbd "s-}") 'tab-bar-switch-to-next-tab)
#+end_src

* deinit
#+begin_src emacs-lisp :lexical no :results silent
(setq gc-cons-threshold 16777216) ; 16MB
#+end_src
